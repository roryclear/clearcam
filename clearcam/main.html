<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resizable & Draggable Rectangle</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            overflow: hidden;
        }
        .controls {
            margin-bottom: 10px;
        }
        .container {
            position: absolute;
            width: 300px;
            height: calc(300px * 9 / 16);
            border: 2px solid black;
            touch-action: none;
        }
        .handle {
            position: absolute;
            width: 20px;
            height: 20px;
            background: red;
            bottom: -10px;
            right: -10px;
            cursor: nwse-resize;
        }
        .drag-area {
            position: absolute;
            width: 10%;
            height: 10%;
            top: 0;
            left: 0;
            background: rgba(0, 0, 0, 0);
            cursor: move;
            z-index: 3;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            position: relative;
            z-index: 1;
        }
    </style>
</head>
<body>
    <div class="controls">
        <input type="text" id="urlInput" placeholder="Enter URL" />
        <button onclick="loadPage()">Enter</button>
    </div>
    <div id="rectangle" class="container">
        <div class="drag-area" id="dragArea"></div>
        <iframe id="contentFrame"></iframe>
        <div class="handle" id="resizeHandle"></div>
    </div>

    <script>
        let isPortrait = false; // Track the current orientation

        function loadPage() {
            const url = document.getElementById('urlInput').value;
            document.getElementById('contentFrame').src = url;
        }

        const rectangle = document.getElementById('rectangle');
        const handle = document.getElementById('resizeHandle');
        const dragArea = document.getElementById('dragArea');
        const iframe = document.getElementById('contentFrame');
        let isResizing = false;
        let isDragging = false;
        let startX, startY, startWidth, startHeight, offsetX, offsetY;

        function addEventListeners(handle, downEvent, moveEvent, upEvent) {
            handle.addEventListener(downEvent, (e) => {
                e.preventDefault();
                isResizing = true;
                startX = e.touches ? e.touches[0].clientX : e.clientX;
                startY = e.touches ? e.touches[0].clientY : e.clientY;
                startWidth = rectangle.offsetWidth;
                startHeight = rectangle.offsetHeight;
                iframe.style.pointerEvents = "none"; // Disable pointer-events during resizing
                document.addEventListener(moveEvent, resize);
                document.addEventListener(upEvent, stopResize);
                document.body.style.cursor = "nwse-resize";
            });
        }

        function resize(e) {
            if (!isResizing) return;
            let clientX = e.touches ? e.touches[0].clientX : e.clientX;
            let newWidth = startWidth + (clientX - startX);

            // Calculate the new height based on the locked aspect ratio
            let newHeight;
            if (isPortrait) {
                // Portrait mode: 9:16 aspect ratio
                newHeight = newWidth * (16 / 9);
            } else {
                // Landscape mode: 16:9 aspect ratio
                newHeight = newWidth * (9 / 16);
            }

            // Update the rectangle's dimensions
            rectangle.style.width = `${newWidth}px`;
            rectangle.style.height = `${newHeight}px`;
        }

        function stopResize() {
            isResizing = false;
            iframe.style.pointerEvents = "auto"; // Re-enable pointer-events after resizing
            document.removeEventListener('mousemove', resize);
            document.removeEventListener('mouseup', stopResize);
            document.removeEventListener('touchmove', resize);
            document.removeEventListener('touchend', stopResize);
            document.body.style.cursor = "default";
        }

        function addDragListeners(handle, downEvent, moveEvent, upEvent) {
            handle.addEventListener(downEvent, (e) => {
                e.preventDefault();
                isDragging = true;
                offsetX = (e.touches ? e.touches[0].clientX : e.clientX) - rectangle.offsetLeft;
                offsetY = (e.touches ? e.touches[0].clientY : e.clientY) - rectangle.offsetTop;
                iframe.style.pointerEvents = "none"; // Disable pointer-events during dragging
                document.addEventListener(moveEvent, drag);
                document.addEventListener(upEvent, stopDrag);
                document.body.style.cursor = "move";
            });
        }

        function drag(e) {
            if (!isDragging) return;
            let clientX = e.touches ? e.touches[0].clientX : e.clientX;
            let clientY = e.touches ? e.touches[0].clientY : e.clientY;
            rectangle.style.left = `${clientX - offsetX}px`;
            rectangle.style.top = `${clientY - offsetY}px`;
        }

        function stopDrag() {
            isDragging = false;
            iframe.style.pointerEvents = "auto"; // Re-enable pointer-events after dragging
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
            document.removeEventListener('touchmove', drag);
            document.removeEventListener('touchend', stopDrag);
            document.body.style.cursor = "default";
        }

        addEventListeners(handle, 'mousedown', 'mousemove', 'mouseup');
        addEventListeners(handle, 'touchstart', 'touchmove', 'touchend');
        addDragListeners(dragArea, 'mousedown', 'mousemove', 'mouseup');
        addDragListeners(dragArea, 'touchstart', 'touchmove', 'touchend');

        // Listen for messages from the embedded page
        window.addEventListener('message', (event) => {
            const message = event.data;

            // Check if the message is a video container update
            if (message.type === 'videoContainerUpdate') {
                const { width, height, portrait } = message;

                // Update the orientation flag
                isPortrait = portrait;

                // Calculate the new width based on the fixed height
                const currentHeight = rectangle.offsetHeight; // Keep the height constant
                let newWidth;

                if (isPortrait) {
                    // Portrait mode: 9:16 aspect ratio
                    newWidth = currentHeight * (9 / 16);
                } else {
                    // Landscape mode: 16:9 aspect ratio
                    newWidth = currentHeight * (16 / 9);
                }

                // Adjust the rectangle's width only
                rectangle.style.width = `${newWidth}px`;
            }
        });
    </script>
</body>
</html>

